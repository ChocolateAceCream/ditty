- state ||= :index 
- state_class = set_state_class_from_state state

%div{ :class => "post #{state_class}" }
  .post_header
    %span.post_title 
      = post_link(post)
    .post_data 
      = time_display(post)
  .post_contents
    = post_contents(post)
    - unless post.tags.nil? or post.tags.empty?
      %br
      Tags: 
      - post.tags.each do |tag|
        %span.tag_link
          %a{ :href => "/tag/#{tag.name}" }
            = tag.name
    - if state == :show
      %hr
      %br
      #comments
        .header Comments: 
        - unless post.comments.nil? or post.comments.empty?
          - post.comments.each do |comment|
            %span.username<= "[#{comment.mongoid_user.email.split("@").first}] "
            %span.comment<= comment.comment
            - if current_user and current_user.admin?
              %a{ :href => "/comment/#{comment.id}/delete" }delete
            %hr
      %br
      %br
      - if logged_in?
        = haml :_form_comment, :layout => false, :locals => { :post_id => post.id }
      - else
        %a{ :href => "/login"}login to add comments
    - else
      %br
      %br
      %a{ :href => post.title_path+"#comments" }View Comments

